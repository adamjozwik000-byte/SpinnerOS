#!/bin/bash
#
# SpinnerOS Session Launcher
# Starts the complete SpinnerOS desktop environment

export XDG_SESSION_TYPE=wayland
export XDG_CURRENT_DESKTOP=SpinnerOS
export XDG_SESSION_DESKTOP=SpinnerOS
export GDK_BACKEND=wayland
export QT_QPA_PLATFORM=wayland
export SDL_VIDEODRIVER=wayland
export CLUTTER_BACKEND=wayland
export MOZ_ENABLE_WAYLAND=1
export GTK_CSD=1

export XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
export XDG_DATA_HOME="${XDG_DATA_HOME:-$HOME/.local/share}"
export XDG_CACHE_HOME="${XDG_CACHE_HOME:-$HOME/.cache}"
export XDG_STATE_HOME="${XDG_STATE_HOME:-$HOME/.local/state}"

mkdir -p "$XDG_CONFIG_HOME/spinneros"
mkdir -p "$XDG_DATA_HOME/spinneros"
mkdir -p "$XDG_CACHE_HOME/spinneros"
mkdir -p "$XDG_STATE_HOME/spinneros"
mkdir -p "$XDG_RUNTIME_DIR"

if [ -f /etc/spinneros/spinner-wm.toml ] && [ ! -f "$XDG_CONFIG_HOME/spinneros/spinner-wm.toml" ]; then
    cp /etc/spinneros/spinner-wm.toml "$XDG_CONFIG_HOME/spinneros/"
fi

if [ -f /etc/spinneros/spinner-shell.toml ] && [ ! -f "$XDG_CONFIG_HOME/spinneros/spinner-shell.toml" ]; then
    cp /etc/spinneros/spinner-shell.toml "$XDG_CONFIG_HOME/spinneros/"
fi

dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE

exec /usr/local/bin/spinner-wm
